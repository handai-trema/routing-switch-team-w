##課題2(経路選択アルゴリズムの実装と可視化)

* コントローラの動作をブラウザで見れるように可視化する
  * 選択した経路やアルゴリズムの動作が分かるように工夫してください

###グループメンバー
* 木藤嵩人  
* 銀杏一輝  
* 永富賢  
* 錦織秀  
* 村上遼  

日付:2016/11/29  

##解答

vis.jsにより、選択した経路やアルゴリズムの動作が確認できるようにした。  
vis.jsで表示するためにjavascriptのファイルを作成した。javascriptのコードは[/routing-switch-team-w/tree/develop/javascript](https://github.com/handai-trema/routing-switch-team-w/tree/develop/javascript)においている。その中で、[前回のトポロジコントローラの課題](https://github.com/handai-trema/topology-team-w/blob/develop/report6-2.md)において、作成した[Draw_network.js](https://github.com/handai-trema/routing-switch-team-w/blob/develop/javascript/Draw_network.js)に可視化のためのコードを追加し、他のコードは公式に配布されているものを利用した。  

経路選択した経路の可視化は[Draw_network.js](https://github.com/handai-trema/routing-switch-team-w/blob/develop/javascript/Draw_network.js)の以下のコードにより、対象のオブジェクトをクリックしたときにできるようにした。

```
var click = function() {
  network.on("click", function (params) {
    console.log('click:', params)
    var path = new Array();
    var newColor = 'red';
    var oldColor = '#848484';
    var oldarrow = {to:false, from:false};
    if (typeof(params.nodes[0]) !== "undefined" && typeof(params.nodes[1]) === "undefined"){
    //ノードが一つだけ選択された場合，そのノードがsrcのパスを表示する
      console.log('one node:', params)
      for(var j in pre_data[0].links){//エッジの色を戻す
        edges.update([{id:pre_data[0].links[j].id, arrows:{to:{enabled:oldarrow.to}, from:{enabled:oldarrow.from}}, color:{color:oldColor,highlight:oldColor}}]);
      }

--------------------------省略-----------------------------

};
```

###動作例:ダイクストラのアルゴリズム
ダイクストラのアルゴリズムを用いてRoutingSwitch.rbを起動した場合の例を示す。  
[routing-switch-team-w/blob/develop/trema.conf](https://github.com/handai-trema/routing-switch-team-w/blob/develop/trema.conf)を用いた場合のトポロジで実行している。  
RoutingSwitch.rbを起動すると以下のようにhtmlが表示される。  

![fig1](https://github.com/handai-trema/routing-switch-team-w/blob/develop/1.png)

次に
```
./bin/trema send_packets --source host1 --dest host4
```
をRoutingSwitch.rbを実行した別のターミナルで実行すると、以下のようにhtmlが表示される。

![fig2](https://github.com/handai-trema/routing-switch-team-w/blob/develop/2.png)

次に
```
./bin/trema send_packets --source host4 --dest host1
```
を実行すると、RoutingSwitch.rbを実行したターミナルで以下のように表示される。
```
Creating path: 44:44:44:44:44:44 -> 0x6:1 -> 0x6:2 -> 0x5:5 -> 0x5:2 -> 0x1:4 -> 0x1:1 -> 11:11:11:11:11:11
```
以下のようにhtmlが表示される。

![fig3](https://github.com/handai-trema/routing-switch-team-w/blob/develop/3.png)

ここで、host4からhost1の最短路が確定した状態になる。ここで、44:44:44:44:44:44のアイコンをクリックすると次のように表示される。

![fig4](https://github.com/handai-trema/routing-switch-team-w/blob/develop/4.png)

この赤い線はhost4(44:44:44:44:44:44)からhost1(11:11:11:11:11:11)への最短路になっていることがわかる。  
画像の下のPath:にはhost4がhost1にまでにホップしたスイッチが表示されている。  

また、次にhost1(11:11:11:11:11:11)からhost4(44:44:44:44:44:44)への最短路を表示するために
```
./bin/trema send_packets --source host1 --dest host4
```
をすることで、host1からhost4までの経路を決定させる。これにより、RoutingSwitch.rbを実行したターミナルで以下のように表示される。
```
Creating path: 11:11:11:11:11:11 -> 0x1:1 -> 0x1:4 -> 0x5:2 -> 0x5:5 -> 0x6:2 -> 0x6:1 -> 44:44:44:44:44:44
```
htmlには、下のような表示が得られる。

![fig5](https://github.com/handai-trema/routing-switch-team-w/blob/develop/5.png)

また、host1(11:11:11:11:11:11)とhost4(44:44:44:44:44:44)を同時に選択(Ctrl+クリック)すると、双方向のパスが次のように表示される。

![fig6](https://github.com/handai-trema/routing-switch-team-w/blob/develop/6.png)

また、新たにhost3を追加した場合も、問題なく最短路が表示される。

![fig7](https://github.com/handai-trema/routing-switch-team-w/blob/develop/6.png)


